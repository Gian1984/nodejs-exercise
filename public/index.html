<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Node.js Full CRUD Frontend</title>
</head>
<body>
<h1>Articles</h1>
<ul id="articles"></ul>

<h2 id="formTitle">Add Article</h2>
<form id="articleForm">
    <input type="text" id="title" placeholder="Title" required />
    <input type="text" id="author" placeholder="Author" required />
    <button type="submit">Save</button>
    <button type="button" id="cancelEdit" style="display:none;">Cancel</button>
</form>

<script>
    let editMode = false;
    let editArticleId = null;

    async function loadArticles() {
        const res = await fetch('http://localhost:3000/api/articles');
        const articles = await res.json();
        const list = document.getElementById('articles');
        list.innerHTML = '';

        articles.forEach(article => {
            const item = document.createElement('li');
            item.innerHTML = `
                <strong>${article.title}</strong> by ${article.author}
                <button onclick="editArticle('${article._id}', '${article.title}', '${article.author}')">Edit</button>
                <button onclick="deleteArticle('${article._id}')">Delete</button>
            `;
            list.appendChild(item);
        });
    }

    async function addArticle(title, author) {
        await fetch('http://localhost:3000/api/articles', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, author })
        });
    }

    async function updateArticle(id, title, author) {
        await fetch(`http://localhost:3000/api/articles/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, author })
        });
    }

    async function deleteArticle(id) {
        if (confirm('Are you sure you want to delete this article?')) {
            await fetch(`http://localhost:3000/api/articles/${id}`, {
                method: 'DELETE'
            });
            loadArticles();
        }
    }

    function editArticle(id, title, author) {
        document.getElementById('title').value = title;
        document.getElementById('author').value = author;
        document.getElementById('formTitle').innerText = 'Edit Article';
        document.getElementById('cancelEdit').style.display = 'inline';
        editMode = true;
        editArticleId = id;
    }

    document.getElementById('articleForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = document.getElementById('title').value.trim();
        const author = document.getElementById('author').value.trim();

        if (editMode) {
            await updateArticle(editArticleId, title, author);
        } else {
            await addArticle(title, author);
        }

        resetForm();
        loadArticles();
    });

    document.getElementById('cancelEdit').addEventListener('click', () => {
        resetForm();
    });

    function resetForm() {
        document.getElementById('title').value = '';
        document.getElementById('author').value = '';
        document.getElementById('formTitle').innerText = 'Add Article';
        document.getElementById('cancelEdit').style.display = 'none';
        editMode = false;
        editArticleId = null;
    }

    loadArticles();
</script>
</body>
</html>
